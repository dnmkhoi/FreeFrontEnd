var signinbox={logCount:0,doingLogin:!1,inputFocused:!1,containerWidth:889,signInUtilModal:{},show:function(e){var t=document.getElementById("signinModal"),o=-1<window.location.href.indexOf("awards/nominees")?document.querySelectorAll(".voteList"):document.getElementById("headerLoginLink");if(navigator.userAgent&&navigator.userAgent.match(/PLAYSTATION/))return document.location.assign("http://"+location.hostname+"/login"),!1;"block"!=t.style.display&&null!=o&&(openModal(e),appendedTasteProfile("js-tasteProfileLoginModal"),document.getElementById("usernameModal").focus())},hide:function(){document.querySelectorAll(".signinError").style.display="none",document.querySelectorAll(".js-signinUsernameModal").value="",document.getElementById("js-signinPasswordModal").value="",document.getElementById("js-redirect").value=""}};function openModal(l){var e=document.getElementById("signinModal"),t=document.querySelectorAll(".js_closeModal");if(e){var s=l;signinbox.signInUtilModal=new MG_Modal({content:e}),null!==typeof signinbox.signInUtilModal&&signinbox.signInUtilModal.openModal(function(e,t){var o=t.querySelectorAll(".js-signinUsernameModal");if((l=t.querySelectorAll("[class*=loginAccessTitle]"))[0].innerHTML=s||textPHTranslation.loginTitle,0<=l[0].innerHTML.toLowerCase().indexOf("subscribe")){var n=document.getElementsByClassName("js-loginFormModal"),a=document.createElement("input");for(a.type="hidden",a.name="subscribe",a.value=1,i=0;i<n.length;i++)n[i].appendChild(a)}if(o[0].focus(),passEvents(t),showCaptcha){var r=t.querySelector(".g-recaptcha");r&&initializeCaptcha(r),toggleButtonDisable(!0)}}),MG_Utils.addEventHandler(t,"click",function(){void 0!==signinbox.signInUtilModal&&(signinbox.signInUtilModal.closeModal(),recaptchaComplete=!1)})}}var expired_modal={premiumPromoModal:document.getElementById("premium-promo-modal"),isExpiredPromoUser:!1,startPremiumUrl:"",noThanksBtnUrl:"",segment:"",promoUser:"",init:function(){this.premiumPromoModal&&(this.promoModal=new MG_Modal({content:this.premiumPromoModal,className:"premiumPromoModalContainer",closeDocument:!1}))},showExpiredPromoModal:function(){var e=this,t="gay"===this.segment?"promoModalWrapperGay":"promoModalWrapperStraight",o=this.isExpiredPromoUser?"promoModalWrapperExpired":"";signinbox.signInUtilModal.closeModal(),setTimeout(function(){e.promoModal.openModal(),$j(".premiumPromoModalContainer .promoModalWrapper").addClass(t),$j(".premiumPromoModalContainer .promoModalWrapper").addClass(o),e.attachHandlers()},0)},attachHandlers:function(){var e=this;$j(".premiumPromoModalContainer .freePromoWeek").on("click",function(){document.location.assign(e.startPremiumUrl)}),$j(".premiumPromoModalContainer #promoCancelFreeWeek, .premiumPromoModalContainer .closeMTubes").on("click",function(){document.location.assign(e.noThanksBtnUrl)})}};function initializeCaptcha(e){try{grecaptcha.render(e,{sitekey:gRecaptchaPublicKey,theme:"dark",callback:function(e){toggleButtonDisable(!(recaptchaComplete=!0))},"expired-callback":function(){toggleButtonDisable(!0)}})}catch(e){}}function toggleButtonDisable(e){var t=currentModalScope.querySelector(".js-signinUsernameModal"),o=currentModalScope.querySelector(".js-signinPasswordModal"),n=currentModalScope.querySelector(".js-loginSubmitModal");e?(MG_Utils.removeEventHandler(n,"click",loginClickFunction),MG_Utils.removeEventHandler(t,"keydown",keyDownFunction),MG_Utils.removeEventHandler(o,"keydown",keyDownFunction),MG_Utils.addClass(n,"disabled")):(MG_Utils.addEventHandler(n,"click",loginClickFunction),MG_Utils.addEventHandler(t,"keydown",keyDownFunction),MG_Utils.addEventHandler(o,"keydown",keyDownFunction),MG_Utils.removeClass(n,"disabled"))}function loginAjaxModal(e,t,o){var n=recaptchaComplete?updateDataWithCaptcha(o):o;if(toggleButtonDisable(!0),XMLHttpRequest){var p=new XMLHttpRequest;p.open(t,e,!0),p.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),p.onreadystatechange=function(){if(4===p.readyState)if(200<=p.status&&p.status<400){var e=JSON.parse(p.responseText);if(e.twoStepVerification){var t=document.querySelectorAll(".js-loginFormModal")[1],o=document.querySelectorAll(".js-userVerificationModal")[1];if(t&&MG_Utils.addClass(t,"hidden"),o){MG_Utils.removeClass(o,"hidden");var n=o.querySelector("#userPhoneNumber"),a=o.querySelector("#enterVerificationCode"),i=o.querySelector("#btnVerifyCode"),r=o.querySelector("#verificationEnabledUsername"),l=o.querySelector("#verificationEnabledToken"),s=o.querySelector("#resendVerificationCode"),d=o.querySelector("#authyIdHashed"),c=o.querySelector("#authyId");n&&(n.innerHTML=e.phoneNumber),r&&l&&(r.value=e.username,l.value=e.autoLoginParameter),c&&d&&(c.value=e.authyId,d.value=e.authyIdHashed),a&&i&&(MG_Utils.addEventHandler(a,"keyup",function(e){""!==a.value?MG_Utils.hasClass(i,"disabled")&&MG_Utils.removeClass(i,"disabled"):MG_Utils.hasClass(i,"disabled")||MG_Utils.addClass(i,"disabled")}),MG_Utils.addEventHandler(document.querySelector("#modalWrapMTubes #btnVerifyCode"),"click",function(e){e.preventDefault(),MG_Utils.hasClass(document.querySelector("#modalWrapMTubes #btnVerifyCode"),"disabled")||loginTwoStepVerificationEnabled()}),MG_Utils.addEventHandler(a,"keydown",function(e){var t=e.which||e.keyCode;13===t&&(e.preventDefault(),MG_Utils.hasClass(i,"disabled")||loginTwoStepVerificationEnabled()),69===t&&e.preventDefault()})),s&&MG_Utils.addEventHandler(s,"click",function(e){e.preventDefault();var t=c.value,o=d.value,n=document.querySelector("#modalWrapMTubes #xsrfToken"),a=document.querySelector("#modalWrapMTubes .resendCodeResponse");if(n){var i=n.value;$j.ajax({type:"POST",url:TOP_BODY.urlResendCode,dataType:"json",data:{authyId:t,authyIdHashed:o,token:i},success:function(e){a&&(MG_Utils.removeClass(a,"hidden"),"success"!=e.status?(MG_Utils.addClass(a,"verificationError"),$j(a).find(".resendCodeStatus").text(e.status+":"),$j(a).find(".resendCodeMessage").text(e.message+" "+PAGE_LAYER.tryAgainMessage)):(MG_Utils.hasClass(a,"verificationError")&&MG_Utils.removeClass(a,"verificationError"),MG_Utils.addClass(a,"verificationSuccess"),$j(a).find(".resendCodeStatus").text(e.status+":"),$j(a).find(".resendCodeMessage").text(e.message),setTimeout(function(){MG_Utils.addClass(a,"hidden")},3e3)))},error:function(){alert(TOP_BODY.ajaxError),document.location.reload()}})}})}}else if(e.requireCaptcha&&"undefined"!=typeof gRecaptchaPublicKey){showCaptcha=!0;var u=currentModalScope.querySelector(".g-recaptcha"),m=currentModalScope.querySelector(".signinError");m.style.display="block",m.innerHTML=e.message,u&&(recaptchaComplete?grecaptcha.reset():initializeCaptcha(u))}else callbackSuccess(e)}else toggleButtonDisable(!1),callbackFailed()},p.send(n)}}function loginTwoStepVerificationEnabled(){$j.ajax({type:"POST",url:TOP_BODY.twoStepVerificationLogin,data:$j("#modalWrapMTubes .js-userVerificationModal").serialize(),success:function(e){var t=document.querySelector("#modalWrapMTubes .twoStepVerificationMessage");t&&MG_Utils.removeClass(t,"hidden"),"0"!=e.success?(t&&MG_Utils.hasClass(t,"verificationError")&&MG_Utils.removeClass(t,"verificationError"),MG_Utils.addClass(t,"verificationSuccess"),t.innerHTML=TOP_BODY.verificationSuccessfulMessage+"...",callbackSuccess(e)):""!=e.message&&t?(MG_Utils.addClass(t,"verificationError"),t.innerHTML=e.message):""==e.message&&(alert(TOP_BODY.ajaxError),document.location.reload())},error:function(){alert(TOP_BODY.ajaxError),document.location.reload()}})}function callbackSuccess(t){var o=currentModalScope.querySelector("#signinLoggingin"),n=currentModalScope.querySelector(".signinError");if("0"==t.premium_redirect_cookie){if(t.showExpiredFreeTrial||t.showExpiredModal)return expired_modal.startPremiumUrl=t.takeFreePremiumUrl,expired_modal.noThanksBtnUrl=t.redirectToPH,expired_modal.segment=t.segment,expired_modal.isExpiredPromoUser=t.showExpiredModal,expired_modal.showExpiredPromoModal(),void toggleButtonDisable(!1);t.redirect?(o.style.display="block",n.style.display="none",void 0!==t.subscribe&&1==t.subscribe?(document.querySelector(".subscribeButton button.login").setAttribute("data-login","0"),subscribeAjax(e,document.querySelector(".subscribeButton button.login"),"",!0,t.redirect)):document.location.assign(t.redirect)):(n.style.display="block",n.innerHTML=t.message,toggleButtonDisable(!1))}else{var a=new Date,i=premiumRedirectCookieURL+(0<premiumRedirectCookieURL.indexOf("?")?"&":"?")+"timestamp="+a.getTime(),r=new XMLHttpRequest;r.withCredentials=!0,r.open("GET",i,!0),r.onreadystatechange=function(){4===this.readyState&&200<=this.status&&this.status<400&&(t.redirect?(o.style.display="",n.style.display="none",document.location.assign(t.redirect)):(n.style.display="",n.innerHTML=t.message,toggleButtonDisable(!1)))},r.send(),r=null}}function callbackFailed(){location.reload}function collectLoginData(e){for(var t={},o=0;o<e.length;o++){var n=e.item(o);t[n.name]=encodeURIComponent(n.value)}return"redirect="+t.redirect+"&token="+t.token+"&remember_me="+t.remember_me+"&from="+t.from+"&username="+t.username+"&password="+t.password+"&subscribe="+t.subscribe+"&setSendTip="+(!!localStorage.getItem("tipsClicked")&&localStorage.getItem("tipsClicked"))}function updateDataWithCaptcha(e){var t=currentModalScope.querySelector(".g-recaptcha-response");return t&&t.value?e+"&g-recaptcha-response="+t.value:e}var keyPressed=!1,currentModalScope=null,showCaptcha=!1,loginClickFunction=function(e){var t=currentModalScope.querySelector(".js-loginFormModal").elements;e.preventDefault?e.preventDefault():e.returnValue=!1,loginAjaxModal("/front/authenticate","POST",collectLoginData(t))},keyDownFunction=function(e){var t=e.which||e.keyCode,o=currentModalScope.querySelector(".js-loginFormModal").elements;keyPressed?keyPressed&&13!=t&&(keyPressed=!1):13==t&&(loginAjaxModal("/front/authenticate","POST",collectLoginData(o)),keyPressed=!0)};function passEvents(e){var t=e.querySelectorAll(".signup_field"),o=e.querySelector('[type="checkbox"]'),n=e.querySelector('[name="remember_me"]'),a=e.querySelector(".js-signinUsernameModal"),r=e.querySelector(".js-signinPasswordModal"),l=e.querySelector(".js-loginSubmitModal");for(currentModalScope=e,i=0;i<t.length;i++)MG_Utils.addEventHandler(t[i],"focus",function(){signinbox.inputFocused=!0}),MG_Utils.addEventHandler(t[i],"blur",function(){signinbox.inputFocused=!1});MG_Utils.addEventHandler(o,"click",function(){n.value=o.checked?1:0}),MG_Utils.addEventHandler(l,"click",loginClickFunction),MG_Utils.addEventHandler(a,"keydown",keyDownFunction),MG_Utils.addEventHandler(r,"keydown",keyDownFunction)}MG_Utils.domReady(function(){document.location.search.match(/showSigninBox=true/i)&&null!=document.getElementById("headerLoginLink")&&signinbox.show(),expired_modal.init()});